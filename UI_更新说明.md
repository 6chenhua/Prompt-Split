# UI界面更新说明 - Mermaid流程图功能

## 🎉 新增功能

### 系统流程图选项卡
在处理结果区域新增了 **🎨 系统流程图** 选项卡，提供以下功能：

1. **自动生成流程图**: 根据子系统和协作关系自动生成Mermaid流程图
2. **类型区分显示**: 不同实现方式的子系统有不同的视觉效果
3. **交互式图例**: 提供详细的图例说明
4. **子系统概览**: 按类型分组显示所有子系统
5. **文件下载**: 支持下载流程图代码和完整文档

## 🎨 视觉效果

### 流程图节点类型
- **🔷 矩形节点 `[子系统-CODE]`**: 蓝色主题，表示代码实现的子系统
- **🔵 圆角矩形节点 `(子系统-CNLP)`**: 紫色主题，表示CNLP实现的子系统  
- **🔶 菱形节点 `{子系统-HYBRID}`**: 绿色主题，表示混合实现的子系统

### 子系统概览卡片
- **💻 代码实现**: 蓝色渐变卡片，显示可直接执行的代码子系统
- **🧠 CNLP实现**: 紫色渐变卡片，显示需要自然语言处理的子系统
- **🔄 混合实现**: 绿色渐变卡片，显示代码与CNLP结合的子系统
- **❌ 处理错误**: 红色主题，显示处理过程中出现错误的子系统

## 🚀 如何使用

### 启动界面
```bash
python ui_streamlit.py
```

### 完整处理流程
1. **输入配置**: 输入要处理的提示词文本
2. **开始处理**: 点击"🚀 开始处理"按钮
3. **查看进度**: 实时监控处理进度，包含"生成Mermaid图"步骤
4. **查看结果**: 处理完成后，切换到"🎨 系统流程图"选项卡

### 流程图功能
- **查看流程图**: 自动渲染的Mermaid流程图
- **理解图例**: 通过图例了解不同节点类型的含义
- **下载资源**: 
  - 📥 下载流程图代码（.md格式）
  - 📄 下载完整文档（包含说明）
- **概览子系统**: 查看按类型分组的子系统实现情况

## ⚙️ 配置选项

### config.json 新增配置
```json
{
  "step2_5_code_generation": {
    "enabled": true,
    "parallel_processing": true,
    "max_workers": 5,
    "test_case_count": 5,
    "timeout_per_task": 60,
    "generate_mermaid": true
  }
}
```

- `generate_mermaid`: 是否生成Mermaid流程图（默认true）

## 📁 输出文件

处理完成后，在 `gen_code/output/` 目录下可以找到：

```
gen_code/output/
├── system_flowchart.md          # 系统流程图
├── system_architecture_doc.md   # 完整架构文档  
├── code_generation_results.json # 代码生成结果
└── [各个子系统的代码文件]
```

## 🔧 技术改进

### 后端优化
1. **并行处理**: mermaid生成与代码生成同时进行
2. **数据结构升级**: 支持subsystems和subprompts两种数据格式
3. **错误容错**: mermaid生成失败不影响其他功能

### 前端增强
1. **响应式设计**: 适配不同屏幕尺寸
2. **美观样式**: 新增专门的CSS样式支持
3. **交互体验**: 流畅的选项卡切换和文件下载

## 🐛 故障排除

### 常见问题

#### 1. 流程图不显示
**症状**: 看到"🔄 流程图生成中..."提示
**解决方案**: 
- 检查是否启用了代码生成步骤
- 确认 `config.json` 中 `generate_mermaid: true`
- 重新运行完整处理流程

#### 2. 子系统显示为错误
**症状**: 子系统概览中显示"❌ 处理错误"
**解决方案**:
- 检查输入文本质量
- 确认API连接正常
- 查看详细日志了解具体错误

#### 3. 下载文件为空
**症状**: 下载的文件内容为空或格式错误
**解决方案**:
- 确保流程图生成成功
- 检查浏览器下载设置
- 刷新页面重新尝试

### 性能优化建议
1. **并行处理**: 建议启用并行处理以提升性能
2. **合理配置**: 根据系统性能调整 `max_workers` 数量
3. **网络稳定**: 确保API连接稳定，避免生成中断

## 📝 更新日志

### v2.1.0 - Mermaid流程图功能
- ✨ 新增系统流程图自动生成
- 🎨 新增类型区分的视觉效果
- 📊 新增子系统概览展示
- 💾 新增流程图文档下载
- ⚡ 优化并行处理性能
- 🔧 改进错误处理机制

---

## 🎯 下一步计划
- [ ] 支持交互式流程图编辑
- [ ] 添加更多流程图模板
- [ ] 支持导出多种格式（PNG、SVG等）
- [ ] 集成流程图实时预览功能 